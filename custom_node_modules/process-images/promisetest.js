var Promise = require("bluebird");
var _ = require("underscore");

Promise.resolved()
	.then(function(){
		var functions = _.map(new Array(5), function(u,i){
			return function(){
				var p = Promise.pending();
				setTimeout(function(){
					console.log("Finished", i);
					p.resolve();
				}, 500);
				return p;
			};
		});
		return _.reduce(functions, when, Promise.resolve());
	});

function when(cur, next) {
    return cur.then(next);
}