var Q = require("q");
var _ = require("underscore");

Q()
	.then(function(){
		var functions = _.map(new Array(5), function(u,i){
			return function(){
				var q = Q.deferred();
				setTimeout(function(){
					console.log("Finished", i);
					q.resolve();
				}, 500);
				return q;
			};
		});
		return _.reduce(functions, Q.when, Q());
	});