var fs = require("fs"); // may want to do some synchronous operations
var Qfs = require("q-io/fs"); // may want to do some synchronous operations
var Q = require("q");
var Path = require("path");
var yargs = require("yargs");
var _ = require("underscore");
var colors = require("colors");
var spawn = require("child-process-promise").spawn;

var processFile = require("./process-file");


function processFolder(src, size){
	console.log(" Processing Folder ".cyan, size, src);
	return Qfs.list(src)
		.then(function(fileList){
			var funcs = _.map(fileList,function(filename){
				var filePath = Path.join(src, filename);

				return function(){
					return Qfs.stat(filePath)
						.then(function(stat){
							if (stat.isFile()){
								return processFile(filePath, size);
							} else if(stat.isDirectory()){
								console.log(" It's a Dir ".cyanBG, filePath);
								return processFolder(filePath, size);
							}
						});
				};

			});
			return _.reduce(funcs, Q.when, Q());
		})
		.then(function(){
			console.log("\n Finished Processing Folder \n".cyan, src, "\n");
		});
}

module.exports = processFolder;